<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>How to write a simple content modifying Chrome extension | Tom Chambers&#39; Tech Blog</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="Writing a Chrome extension can be a bit tricky initially, due to it’s API and the way you have to structure your code. The docs are fairly good however, so take a look at them when building your tool.">
<meta property="og:type" content="article">
<meta property="og:title" content="How to write a simple content modifying Chrome extension">
<meta property="og:url" content="http://tech-blog.tomchambers.me/2016/01/13/How-to-write-a-simple-page-rewriting-Chrome-extension/index.html">
<meta property="og:site_name" content="Tom Chambers' Tech Blog">
<meta property="og:description" content="Writing a Chrome extension can be a bit tricky initially, due to it’s API and the way you have to structure your code. The docs are fairly good however, so take a look at them when building your tool.">
<meta property="og:image" content="http://tech-blog.tomchambers.me/images/undead-extensions.png">
<meta property="og:image" content="http://tech-blog.tomchambers.me/images/undead-hello-world.png">
<meta property="og:image" content="http://tech-blog.tomchambers.me/images/undead-popup.png">
<meta property="og:updated_time" content="2016-01-13T23:48:59.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How to write a simple content modifying Chrome extension">
<meta name="twitter:description" content="Writing a Chrome extension can be a bit tricky initially, due to it’s API and the way you have to structure your code. The docs are fairly good however, so take a look at them when building your tool.">
  
    <link rel="alternative" href="/atom.xml" title="Tom Chambers&#39; Tech Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>
<body>
	<a href="http://tomchambers.me" target="_blank"><div class="see-more"><p class="see-more-inside">Back to Tom Chambers home</p></div></a>
  <div id="container">
    <div class="mobile-nav-panel">
	<i class="icon-reorder icon-large"></i>
</div>
<div style="text-align:center">
	<img src="/images/tom-chambers-robot-face.png" alt="">
</div>
<header id="header">
	<h1 class="blog-title">
		<a href="/">Tom Chambers&#39; Tech Blog</a>
	</h1>
	<nav class="nav">
		<ul>
			<li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li>
			<li><a id="nav-search-btn" class="nav-icon" title="Search"></a></li>
			<li><a href="/atom.xml" id="nav-rss-link" class="nav-icon" title="RSS Feed"></a></li>
		</ul>
	</nav>
	<div id="search-form-wrap">
		<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://tech-blog.tomchambers.me"></form>
	</div>
</header>
    <div id="main">
      <article id="post-How-to-write-a-simple-page-rewriting-Chrome-extension" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2016/01/13/How-to-write-a-simple-page-rewriting-Chrome-extension/" class="article-date">
  <time datetime="2016-01-13T17:11:20.000Z" itemprop="datePublished">2016-01-13</time>
</a>
		</span>
		<span class="meta-elements author">Tom Chambers</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 class="article-title entry-title" itemprop="name">
      How to write a simple content modifying Chrome extension
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>Writing a Chrome extension can be a bit tricky initially, due to it’s API and the way you have to structure your code. The <a href="https://developer.chrome.com/extensions" target="_blank" rel="external">docs</a> are fairly good however, so take a look at them when building your tool.</p>
<p>In this post I want to show how you can write a simple extension that modifies the content of the page once it’s loaded. This is a method used by extensions like the various adblockers to identify and remove adverts. It’s a good place to start since it gets you used to the environment without getting too complicated. The whole lot is in javascript, which gives you easy access to the DOM and is essentially like writing client side code except you have a few extra APIs for access to the browser and code is scoped meaning you can’t communicate with code that the page loads.</p>
<h2 id="Setting_up">Setting up</h2><p>Every extension needs a manifest file. It declares what files are a part of your project and tells Chrome how to use them. You also set metadata like icons and descriptions which will be used when you upload your extension to the Chrome app store (this is the only sensible way to distribute it outside of a corporate environment).</p>
<figure class="highlight json"><figcaption><span>[manifest.json] []</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">manifest_version</span>": <span class="value"><span class="number">2</span></span>,</span><br><span class="line"></span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"My new extension"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">"It does stuff"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1"</span></span>,</span><br><span class="line"></span><br><span class="line">  "<span class="attribute">icons</span>": <span class="value">&#123; "<span class="attribute">16</span>": <span class="value"><span class="string">"ext_16.png"</span></span>,</span><br><span class="line">           "<span class="attribute">48</span>": <span class="value"><span class="string">"ext_48.png"</span></span>,</span><br><span class="line">          "<span class="attribute">128</span>": <span class="value"><span class="string">"ext_128.png"</span> </span>&#125;</span>,  </span><br><span class="line"></span><br><span class="line">  "<span class="attribute">background</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">page</span>": <span class="value"><span class="string">"background.html"</span></span><br><span class="line">  </span>&#125;</span>,  </span><br><span class="line">  "<span class="attribute">content_scripts</span>": <span class="value">[</span><br><span class="line">    &#123;</span><br><span class="line">      "<span class="attribute">matches</span>": <span class="value">[<span class="string">"https://www.site-to-run-on.com/*"</span>]</span>,</span><br><span class="line">      "<span class="attribute">js</span>": <span class="value">[<span class="string">"helper_library.js"</span>, <span class="string">"content_script.js"</span>]</span><br><span class="line">    </span>&#125;</span><br><span class="line">  ]</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>All the files for your extension should be in the same directory, which will be zipped up when you upload it. The manifest is what binds it all together. If it’s not referenced in there, it won’t be used.</p>
<h2 id="Architecture_of_an_extension">Architecture of an extension</h2><ul>
<li><strong>Background page</strong> - not visible by the user. A long running script that handles the state of your extension. Communicates with other parts of the extension with messaging.</li>
<li><strong>Event page</strong> - the same as a background page, but only executes in response to events you define. Preferred to background pages as they are less resource intensive.</li>
<li><strong>Options page</strong> - UI page that allows a user to set options. An HTML page that references javascript files.</li>
<li><strong>Browser actions/page actions</strong> - an icon either in the extension bar or the omnibox respectively. Clicking on the icon will show a UI tab which is an HTML page that can reference javascript. These pages cannot communicate with the website resources/DOM, it needs to message the content script to do that. </li>
<li><strong>Content scripts</strong> - javascript only. What is used to modify the page itself. The only part that can access and modify the DOM but not code loaded by the website. Files are run once for each page that matches the manifest. All the JS files in the list are loaded, so you can use libraries just by including it. This is what we’ll use for our extension.</li>
</ul>
<p>There are plenty more elements that can be used in an extension, but this list covers the core that will get most of your extension built and most other parts are for specific tasks.</p>
<h2 id="Permissions">Permissions</h2><p>When users see ‘This extension can see and modify data on all pages’, they get nervous. So it’s best to limit where your extension will be active by explicitly setting permissions in the manifest.</p>
<figure class="highlight prolog"><figcaption><span>[manifest.json]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"permissions"</span>: [</span><br><span class="line">    <span class="string">"tabs"</span>, <span class="string">"http://www.google.com/*"</span></span><br><span class="line">  ],</span><br></pre></td></tr></table></figure>
<p>In this case, the extension will load content scripts when on any page on Google and use the tabs API. * is a wildcard matching any number of characters including none, ? matches any single character. So b?b would match bob and bib but not boob. <a href="https://developer.chrome.com/extensions/content_scripts#match-patterns-globs" target="_blank" rel="external">See more</a>.</p>
<p>You’ll also need to specify what pages your content scripts will match and run on. More on this in the next section.</p>
<h2 id="Writing_your_own_extension">Writing your own extension</h2><p>I’ll now go through the steps of creating an extension I wrote recently called <a href="https://chrome.google.com/webstore/detail/undead/lgdmnghdmjmfnlcponkapgpmdijifoff" target="_blank" rel="external">Undead</a> that removes details about people’s deaths from Wikipedia. I made it because I often watch old films and google the cast and then am shocked and saddened to find out that actors that were young attractive women in 1938 are now dead. So this extension allows me to live in a glorious past where everyone ever is still alive.</p>
<h3 id="Manifest">Manifest</h3><p>Let’s start with the manifest. We need to state which version it is, if you’re uploading a new version to the web store, the version number must be greater than the existing one. Don’t confuse this with the manifest_version, which is always 2 and is not extension specific.</p>
<p>Create a new folder called ‘undead’ then a new file called ‘manifest.json’ inside it and copy the following into it.</p>
<figure class="highlight json"><figcaption><span>[manifest.json]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">manifest_version</span>": <span class="value"><span class="number">2</span></span>,</span><br><span class="line"></span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"Undead"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">"This extension removes any details of people's deaths from Wikipedia"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1.1"</span></span>,</span><br><span class="line"></span><br><span class="line">  "<span class="attribute">icons</span>": <span class="value">&#123; "<span class="attribute">16</span>": <span class="value"><span class="string">"daisy_16.png"</span></span>,</span><br><span class="line">           "<span class="attribute">48</span>": <span class="value"><span class="string">"daisy_48.png"</span></span>,</span><br><span class="line">          "<span class="attribute">128</span>": <span class="value"><span class="string">"daisy_128.png"</span> </span>&#125;</span>,  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You must supply 3 icons at sizes 16, 48 and 128 px. These are used on the extensions page and the toolbar. Download them here and save them into the directory at the same level as manifest.json:</p>
<ul>
<li><a href="https://raw.githubusercontent.com/tomchambers2/undead/master/daisy_16.png" target="_blank" rel="external">16</a> </li>
<li><a href="https://raw.githubusercontent.com/tomchambers2/undead/master/daisy_48.png" target="_blank" rel="external">48</a></li>
<li><a href="https://raw.githubusercontent.com/tomchambers2/undead/master/daisy_128.png" target="_blank" rel="external">128</a></li>
</ul>
<p>You can now load your bare bones extension into Chrome. Go to Window -&gt; Extensions to open the extensions page. Tick developer mode on the top right which allows you to load your own extensions. Click the ‘Load unpacked extension’ button and then select the ‘undead’ directory. You should now have something that looks like this:</p>
<p><img src="/images/undead-extensions.png" alt=""></p>
<p>There you go. Technically that’s all you need for an extension. But it doesn’t do very much of course. To modify a page we need a content script. Add the following to your manifest in addition to the above:</p>
<figure class="highlight prolog"><figcaption><span>[manifest.json]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"content_scripts"</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"matches"</span>: [<span class="string">"https://en.wikipedia.org/*"</span>],</span><br><span class="line">    <span class="string">"js"</span>: [<span class="string">"undead.js"</span>],</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Now save a new file called undead.js and the following as the content:</p>
<figure class="highlight javascript"><figcaption><span>[undead.js]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">document</span>.write(<span class="string">'Hello world'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Go back to the extensions page and hit reload (this is very important. If you ever wonder why nothing changed even though you updated the code this is probably the reason).</p>
<p>Go to a <a href="https://en.wikipedia.org/wiki/Blade_Runner" target="_blank" rel="external">page on Wikipedia</a> and now you should see this:<br><img src="/images/undead-hello-world.png" alt=""></p>
<p>Great! Now we could write the whole lot in native javascript, but it’s useful to see how we can have multiple files and use libraries so let’s drop jquery in there too. Download it from <a href="http://code.jquery.com/jquery-2.2.0.min.js" target="_blank" rel="external">here</a> and drop it in the top level of the extension directory. Then update the manifest to include it:</p>
<figure class="highlight prolog"><figcaption><span>[manifest.json]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"content_scripts"</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"matches"</span>: [<span class="string">"https://en.wikipedia.org/*"</span>],</span><br><span class="line">    <span class="string">"js"</span>: [<span class="string">"jquery-2.2.0.min.js"</span>, <span class="string">"undead.js"</span>],</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Now we have jquery available to us so we can select elements in the page and remove them. Let’s start with the ‘Died’ part of the table on the infobox.</p>
<p>Get rid of the code in undead.js and put this there instead:</p>
<figure class="highlight stylus"><figcaption><span>[undead.js]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'th:contains("Died")'</span>).<span class="function"><span class="title">parent</span><span class="params">()</span></span>.<span class="function"><span class="title">hide</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
<p>Reload it and have a look at a <a href="https://en.wikipedia.org/wiki/Clark_Gable" target="_blank" rel="external">dead person’s page</a>. Well, it’s a start. Here’s some more comprehensive rules I came up with:</p>
<figure class="highlight javascript"><figcaption><span>[undead.js]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'th:contains("Died")'</span>).parent().hide()</span><br><span class="line"></span><br><span class="line">$(<span class="string">'th:contains("Died")'</span>).parent().hide()</span><br><span class="line">$(<span class="string">'th:contains("death")'</span>).parent().hide()</span><br><span class="line">$(<span class="string">'th:contains("Resting place")'</span>).parent().hide()</span><br><span class="line"></span><br><span class="line">$(<span class="string">'td:contains("death")'</span>).parent().hide()</span><br><span class="line"></span><br><span class="line">$(<span class="string">'span:contains("Death")'</span>).parent().hide()</span><br><span class="line"></span><br><span class="line">$(<span class="string">'p'</span>).not(<span class="string">'.infobox p'</span>).first().html(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> $(<span class="keyword">this</span>).html().replace(<span class="string">'was'</span>, <span class="string">'is'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hidden = [<span class="string">'died'</span>,<span class="string">'remains'</span>,<span class="string">'funeral'</span>,<span class="string">'death'</span>,<span class="string">'autopsy'</span>,<span class="string">'suicide'</span>,<span class="string">'cremated'</span>,<span class="string">'interred'</span>,<span class="string">'mausoleum'</span>]</span><br><span class="line">hidden.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">word</span>) </span>&#123;</span><br><span class="line">	$(<span class="string">'p:contains('</span>+word+<span class="string">')'</span>).hide()</span><br><span class="line">	$(<span class="string">'li:contains('</span>+word+<span class="string">')'</span>).hide()</span><br><span class="line">	$(<span class="string">'span:contains('</span>+word+<span class="string">')'</span>).hide()	</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">$(<span class="string">'p'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> html = $(<span class="keyword">this</span>).html()</span><br><span class="line">    $(<span class="keyword">this</span>).html(html.replace(<span class="string">'was survived by'</span>, <span class="string">'lives with'</span>))</span><br><span class="line">    $(<span class="keyword">this</span>).html(html.replace(<span class="regexp">/(&amp;nbsp;| )– [0-9a-zA-Z, ]+\)/</span>, <span class="string">')'</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Reload. That’s working a bit better. But it’s still a bit slow. When javascript runs in the browser it runs immediately, which is why we normally use $(document).ready or similar to delay the execution of that code until the DOM has been constructed. However Chrome doesn’t run the code until everything has loaded, the equivalent of window.onload, making the window.onload callback in the first example unnecessary.</p>
<p>We can choose when we want the content scripts to be injected. Choices are ‘document_start’, after css is loaded but before DOM. ‘document_end’ after DOM complete but before images and the default ‘document_idle’ after window.onload. If we used the first one we’d end up with no changes, because it would run before it has any content to manipulate. So update manifest.json to include this:</p>
<figure class="highlight prolog"><figcaption><span>[manifest.json]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"content_scripts"</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"matches"</span>: [<span class="string">"https://en.wikipedia.org/*"</span>],</span><br><span class="line">    <span class="string">"js"</span>: [<span class="string">"jquery-2.2.0.min.js"</span>, <span class="string">"undead.js"</span>],</span><br><span class="line">    <span class="string">"run_at"</span>: <span class="string">"document_end"</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Now it should run without an annoying gap inbetween the page load and rerendering.</p>
<h2 id="Adding_a_browser_action">Adding a browser_action</h2><p>Maybe sometimes the user should face up to reality and find out the truth. We could add a bit more functionality to this by creating an undo button that adds back all the death notes to the page. To do this we’ll need a browser action with a button that sends a message to the content script, which will then revert to the original content.</p>
<p>Create a popup:<br><figure class="highlight xml"><figcaption><span>[popup.html]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"popup.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">Goodbye world</span><br></pre></td></tr></table></figure></p>
<p>and the JS file:<br><figure class="highlight stylus"><figcaption><span>[popup.js]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.<span class="function"><span class="title">log</span><span class="params">(<span class="string">'A message'</span>)</span></span></span><br></pre></td></tr></table></figure></p>
<p>You’ll see this:<br><img src="/images/undead-popup.png" alt=""> </p>
<p>Reload. Check the console of the page and… oh, nothing there. The browser action writes to its own console since its separated from the page. Right click the icon and click ‘Inspect popup’ to see the separate console and you’ll see its message.</p>
<p>Now update these files to create the functionality of a button that sends a message that can be received and acted on by the content script:</p>
<figure class="highlight xml"><figcaption><span>[popup.html]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>Popup<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"jquery-2.1.4.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"popup.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">button</span> <span class="attribute">class</span>=<span class="value">"deadify"</span>&gt;</span>Deadify<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><figcaption><span>[popup.js]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	$(<span class="string">'.deadify'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		chrome.runtime.sendMessage(&#123; undo: <span class="literal">true</span> &#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><figcaption><span>[undead.js]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> copy = $(<span class="string">'body'</span>).clone()</span><br><span class="line"></span><br><span class="line"><span class="comment">// existing code</span></span><br><span class="line"></span><br><span class="line">chrome.runtime.onMessage.addListener(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	$(<span class="string">'body'</span>).html($(copy))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Now you can open up the popup and reverse the effect of the extension at will. In this case $(document).ready is necessary because javascript loads normally as specified in the HTML rather than injected in by Chrome.</p>
<p><strong>Note:</strong> this is a very simplified version of what should happen. If this was a real extension it would be a good idea to add a background page that manages state to prevent too much complexity in the UI files and set a tab target and parameters to your messages to limit its effect. Take a look at <a href="https://developer.chrome.com/extensions/messaging" target="_blank" rel="external">message passing</a> to learn more.</p>
<p>Now you know what’s possible, I’m sure your head will start fizzing over with interesting and useful things you can add to the browser. For a reference once you’ve grasped the basics, see the <a href="https://developer.chrome.com/extensions/devguide" target="_blank" rel="external">Developer’s guide</a>. The code is a <a href="https://github.com/tomchambers2/undead" target="_blank" rel="external">repo on my github</a>. If you need help please email me on tom.chambers@gmail.com.</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
			</span>
		</div>
	</footer>
	
    
<nav id="article-nav">
  
  
    <a href="/2016/01/05/Necklace/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          Necklace
        
      </div>
    </a>
  
</nav>

  
</article>




    </div>
    <div class="mb-search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:tech-blog.tomchambers.me">
  </form>
</div>
<footer id="footer">
	<h1 class="footer-blog-title">
		<a href="/">Tom Chambers&#39; Tech Blog</a>
	</h1>
	<span class="copyright">
		&copy; 2016 Tom Chambers<br>
		Modify from <a href="http://sanographix.github.io/tumblr/apollo/" target="_blank">Apollo</a> theme, designed by <a href="http://www.sanographix.net/" target="_blank">SANOGRAPHIX.NET</a><br>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	</span>
</footer>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js" type="text/javascript"></script>
  </div>
</body>
</html>